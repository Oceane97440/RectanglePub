<script> listImagesARP = new Array();

// Compte le nombre ID sur la page
window.addEventListener("DOMContentLoaded", function() {
	if(listImagesARP.length === 0) {
		document.querySelectorAll("div.advertising-arp").forEach(function(element) {
			console.log("Canvas : "+element.id); 
			listImagesARP.push(element.id);
		});
	} // else {
		console.log("listImagesARP : "+listImagesARP.length);
	// }
});

/*
* Chargement des pubs au fur et Ãƒ  mesure
*/
function lazyLoad(targets, attrSource, callback) {
	var IDsAds = targets || document.querySelectorAll("div.advertising-arp");
	
	//function to test if the div is in view
	function isScrolledIntoView(id) {
	    var adVisibility = 0.5;
		var elemTop = document.getElementById(id).getBoundingClientRect().top;
		var elemBottom = document.getElementById(id).getBoundingClientRect().bottom;
		elemBottom = elemBottom - ((elemBottom - elemTop) * (1 - adVisibility));
		elemBottomOFF = elemBottom - (elemBottom - elemTop);


		var isVisible = (elemTop >= 0) && (elemBottom <= window.innerHeight);
		console.log("top =" + elemTop);
		console.log("bottomVisibility =" + elemBottom);
		console.log("bottomVisibilityOFF =" + elemBottomOFF);
		return isVisible;
	}

	function checkVisible(element) {
		var rect = element.getBoundingClientRect(),
		viewHeight = Math.max(document.documentElement.clientHeight, window.innerHeight);		
		return !(rect.bottom < 0 || rect.top - viewHeight >= 0);
	}

   [].forEach.call(IDsAds, function(advertise) {
		var id = advertise.getAttribute("id");		
		// Si la pub est visible et que l'ID Ads est dans le tableau on le charge
		//--- if ( checkVisible(advertise) && (listImagesARP.length > 0) && listImagesARP.includes(id)) {
		if ( isScrolledIntoView(id) && (listImagesARP.length > 0) && listImagesARP.includes(id)) {
			ADTECH.loadAd(advertise.getAttribute('id'));
			listImagesARP.splice(listImagesARP.indexOf(id),1);
		}
	  
	});
  
}


// Lazy Load on Scroll
window.addEventListener("scroll", function() {
  lazyLoad();
});
</script>